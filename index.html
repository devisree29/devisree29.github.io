<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="./styles.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        <div class="container">
            <div>
                <h1 class="header_text">Ah, a curious soul! Ready to uncover a magical secret?</h1>
            </div>
            <div class="gif_container">
                <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExcDdtZ2JiZDR0a3lvMWF4OG8yc3p6Ymdvd3g2d245amdveDhyYmx6eCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/cLS1cfxvGOPVpf9g3y/giphy.gif" alt="Cute animated illustration">
            </div>
            <canvas id="myCanvas"></canvas>
            <script>
                const LINE_DURATION = 2;
                const LINE_WIDTH_START = 5;

                $(document).ready(function() {
                    enableDrawingCanvas();
                    resizeCanvas(window.innerWidth, window.innerHeight);

                    $(document).keypress(function(event) {
                        if (event.key === "1") mode = 1;
                        if (event.key === "2") mode = 2;

                        if (event.key == "q") spread = 1;
                        if (event.key == "w") spread = 2;

                        if (event.key == "a") pathMode = 1;
                        if (event.key == "s") pathMode = 2;

                        if (event.key == "z") {
                            if (lineWidthStart < 100) lineWidthStart++;
                        }
                        if (event.key == "x") {
                            if (lineWidthStart > 1) lineWidthStart--;
                        }

                        if (event.key == "g") {
                            if (canvas === undefined)
                                enableDrawingCanvas();

                            var poopx = [];
                            var poopy = [];

                            function spawn() {
                                var gap = 10;
                                var rows = 10;
                                var cols = 3;

                                var canvas = $('#myCanvas');
                                var width = canvas.width();
                                var height = canvas.height();
                                var count = 0;

                                for (var i = (width / 2) - (gap * rows); i < (width / 2) + (gap * rows); i = i + gap) {

                                    if (i % (gap * 2) === 0) {
                                        for (var j = (height / 2) - (gap * cols); j < (height / 2) + (gap * cols); j = j + gap) {

                                            poopx.push(i);
                                            poopy.push(j);

                                        }
                                    } else {
                                        for (var j = (height / 2) + (gap * cols) - gap; j > (height / 2) - (gap * cols) - gap; j = j - gap) {

                                            poopx.push(i);
                                            poopy.push(j);
                                        }
                                    }
                                }
                            }
                            asd();

                            function asd() {
                                if (poopx.length <= 0) {
                                    spawn();
                                }

                                var x = poopx.pop();
                                var y = poopy.pop();

                                addPoint(x, y);

                                setTimeout(function() {
                                    asd()
                                }, 10);
                            }
                        }
                    });
                });

                var active = true;
                var canvas;
                var context;

                var newWidth = 1000;
                var newHeight = 800;

                var mode = 1;
                var pathMode = 1;
                var spread = 2;

                var lineColor = 'rgb(237, 184, 131)';
                var lineDuration = LINE_DURATION;
                var lineFadeLinger = 1;
                var lineWidthStart = LINE_WIDTH_START;
                var fadeDuration = 50;
                var drawEveryFrame = 1;

                var clickCount = 0;
                var frame = 0;

                var flipNext = true;

                var points = [];

                function enableDrawingCanvas() {
                    if (canvas === undefined) {
                        canvas = document.getElementById('myCanvas');
                        context = canvas.getContext('2d');
                        enableListeners();
                        init();
                    }
                }

                function init() {
                    draw();
                }

                function draw() {
                    if (active) {
                        animatePoints();
                        window.requestAnimFrame(draw);
                    }
                }

                function animatePoints() {
                    context.clearRect(0, 0, context.canvas.width, context.canvas.height);

                    var duration = lineDuration * 1000 / 60;
                    var point, lastPoint;

                    if (pathMode === 2) {
                        context.beginPath();
                    }

                    for (var i = 0; i < points.length; i++) {
                        point = points[i];

                        if (points[i - 1] !== undefined) {
                            lastPoint = points[i - 1];
                        } else {
                            lastPoint = points[i];
                        }

                        point.lifetime += 1;

                        if (point.lifetime > duration) {
                            points.splice(i, 1);
                            continue;
                        }

                        var inc = (point.lifetime / duration);
                        var dec = 1 - inc;

                        var spreadRate;
                        if (spread === 1) {
                            spreadRate = lineWidthStart / (point.lifetime * 2);
                        }
                        if (spread === 2) {
                            spreadRate = lineWidthStart * (1 - inc);
                        }

                        var fadeRate = dec;

                        context.lineJoin = "round";
                        context.lineWidth = spreadRate;
                        context.strokeStyle = 'rgb(' + Math.floor(255) + ',' +
                            Math.floor(200 - (255 * dec)) + ',' +
                            Math.floor(200 - (255 * inc)) + ')';

                        var distance = Point.distance(lastPoint, point);
                        var midpoint = Point.midPoint(lastPoint, point);
                        var angle = Point.angle(lastPoint, point);

                        if (pathMode === 1) {
                            context.beginPath();
                        }

                        if (mode === 1) {
                            context.arc(midpoint.x, midpoint.y, distance / 2, angle, (angle + Math.PI), point.flip);
                        }

                        if (mode === 2) {
                            context.moveTo(lastPoint.x, lastPoint.y);
                            context.lineTo(point.x, point.y);
                        }

                        if (pathMode === 1) {
                            context.stroke();
                            context.closePath();
                        }
                    }

                    if (pathMode === 2) {
                        context.stroke();
                        context.closePath();
                    }
                }

                function addPoint(x, y) {
                    flipNext = !flipNext;
                    var point = new Point(x, y, 0, flipNext);
                    points.push(point);
                }

                window.requestAnimFrame = (function(callback) {
                    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
                        function(callback) {
                            window.setTimeout(callback, 1000 / 60);
                        };
                })();

                function resizeCanvas(w, h) {
                    if (context !== undefined) {
                        context.canvas.width = w;
                        context.canvas.height = h;

                        newWidth = w;
                        newHeight = h;
                    }
                }

                function enableListeners() {
                    $('#myCanvas').on('mousemove', function(e) {
                        if (frame === drawEveryFrame) {
                            addPoint(e.pageX - this.offsetLeft, e.pageY - this.offsetTop);
                            frame = 0;
                        }
                        frame++;
                    });

                    $('#myCanvas').on('mouseover', function(e) {});
                    $('#myCanvas').on('mouseleave', function(e) {});

                    $('#myCanvas').on('touchstart', function(e) {
                        var touch = e.touches[0];
                    });
                    $('#myCanvas').on('touchmove', function(e) {
                        var touch = e.touches[0];
                    });
                    $('#myCanvas').on('touchend', function(e) {});
                }

                class Point {
                    constructor(x, y, lifetime, flip) {
                        this.x = x;
                        this.y = y;
                        this.lifetime = lifetime;
                        this.flip = flip;
                    }

                    static distance(a, b) {
                        const dx = a.x - b.x;
                        const dy = a.y - b.y;

                        return Math.sqrt(dx * dx + dy * dy);
                    }

                    static midPoint(a, b) {
                        const mx = a.x + (b.x - a.x) * 0.5;
                        const my = a.y + (b.y - a.y) * 0.5;

                        return new Point(mx, my);
                    }

                    static angle(a, b) {
                        const dx = a.x - b.x;
                        const dy = a.y - b.y;

                        return Math.atan2(dy, dx);
                    }

                    get pos() {
                        return this.x + "," + this.y;
                    }
                }
            </script>
            <div class="buttons">
                <button class="btn" id="yesButton" onclick="nextPage()">Yes, unveil the magic!</button>
                <button class="btn" id="noButton" onmouseover="moveButton()" onclick="moveButton()">No, I am a muggle!</button>
                <script>
                    function nextPage() {
                        window.location.href = "yes.html";
                    }

                    function moveButton() {
                        var x = Math.random() * (window.innerWidth - document.getElementById('noButton').offsetWidth) - 85;
                        var y = Math.random() * (window.innerHeight - document.getElementById('noButton').offsetHeight) - 48;
                        document.getElementById('noButton').style.position = "absolute";
                        document.getElementById('noButton').style.left = `${x}px`;
                        document.getElementById('noButton').style.top = `${y}px`;
                    }
                </script>
            </div>
        </div>
    </body>
</html>
